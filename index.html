<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spin Hadiah Booth</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: url('poster.png') no-repeat center center;
    background-size: cover;
    font-family: Arial, sans-serif;
    color: white;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #wheelContainer {
    position: relative;
    width: 80vw;
    max-width: 400px;
    aspect-ratio: 1 / 1;
    margin-top: calc(16vh + 50px);
  }

  #wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 6px solid white;
    position: relative;
    background: rgba(0,0,0,0.1);
    overflow: hidden;
  }

  #wheelCanvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  #spinBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 25px;
    background: red;
    color: white;
    border: none;
    font-size: 18px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 5;
  }

  #toggleStockBtn {
  position: absolute;
  top: 10px;       /* jarak dari atas wheelContainer */
  right: 10px;     /* jarak dari kanan wheelContainer */
  width: 40px;
  height: 40px;
  padding: 0;
  background: rgba(0,0,0,0.6);
  border: 1px solid white;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}


  #stockList {
    margin-top: 15px;
    background: rgba(0,0,0,0.5);
    padding: 10px 15px;
    border-radius: 10px;
    font-size: 16px;
    max-height: 250px;
    overflow-y: auto;
    width: 90%;
    max-width: 400px;
    display: none;
  }

  #stockList ul { list-style: none; padding: 0; margin: 0; }
  #stockList li {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
  }

  #resetBtn {
    margin-top: 10px;
    padding: 10px 15px;
    width: 100%;
    background: rgba(255,0,0,0.8);
    font-size: 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  #popup {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 1000;
    color: white;
    text-align: center;
  }

  #popup h1 { font-size: 2.5em; margin-bottom: 20px; }
  #doneBtn {
    padding: 10px 20px;
    font-size: 18px;
    background: red;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="wheelContainer">
  <div id="wheel">
    <canvas id="wheelCanvas"></canvas>
    <button id="spinBtn">ðŸŽ¯ SPIN</button>
  </div>
</div>

<button id="toggleStockBtn">ðŸ“‹</button>

<div id="stockList">
  <ul id="stockUl"></ul>
  <button id="resetBtn">ðŸ”„ Reset Stok Hadiah</button>
</div>

<div id="popup">
  <h1 id="popupText"></h1>
  <button id="doneBtn">Selesai</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const defaultPrizes = [
  { name: "Sticker", stock: 7 },
  { name: "Pulpen", stock: 16 },
  { name: "Topi", stock: 2 },
  { name: "Kaos Toraja Roadster", stock: 1 },
  { name: "PhotoCard", stock: 1 },
  { name: "Kaos ESA + Devilbiss", stock: 1 },
  { name: "Flash Disc", stock: 4 },
  { name: "Voucher Tokped Disc 10%", stock: 3 },
  { name: "Voucher Tokped Disc 20%", stock: 3 },
];

let prizes = [];
const wheel = document.getElementById("wheel");
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const toggleStockBtn = document.getElementById("toggleStockBtn");
const stockList = document.getElementById("stockList");
const stockUl = document.getElementById("stockUl");
const resetBtn = document.getElementById("resetBtn");
const popup = document.getElementById("popup");
const popupText = document.getElementById("popupText");
const doneBtn = document.getElementById("doneBtn");

const totalSlices = defaultPrizes.length;
let currentRotation = 0;
let isSpinning = false;

function loadPrizes() {
  const saved = localStorage.getItem("spinPrizes");
  prizes = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultPrizes));
}
function savePrizes() {
  localStorage.setItem("spinPrizes", JSON.stringify(prizes));
}

function resizeCanvas() {
  const rect = wheel.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  drawWheel();
}

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const colors = ['#2332EB', '#9EB2DB', '#4E6EF2'];
  const radius = canvas.width / 2;
  const arcSize = (2 * Math.PI) / totalSlices;

  for (let i = 0; i < totalSlices; i++) {
    const angle = i * arcSize;
    ctx.fillStyle = colors[i % 3];
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, angle, angle + arcSize);
    ctx.closePath();
    ctx.fill();

    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(angle + arcSize / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "white";
    let fontSize = radius / 8;
    ctx.font = `bold ${fontSize}px Arial`;
    ctx.fillText(prizes[i].name, radius * 0.85, 5);
    ctx.restore();
  }
}

function updateStockList() {
  stockUl.innerHTML = "";
  prizes.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `<span>${p.name}</span><span>${p.stock}</span>`;
    stockUl.appendChild(li);
  });
}

function pickPrize() {
  let totalStock = prizes.reduce((sum, p) => sum + p.stock, 0);
  let r = Math.random() * totalStock;
  let acc = 0;
  for (let p of prizes) {
    acc += p.stock;
    if (r <= acc) return p;
  }
}

function showPopup(prize) {
  popupText.textContent = `ðŸŽ‰ Selamat Kamu dapat: ${prize}`;
  popup.style.display = "flex";
  confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
}

doneBtn.addEventListener("click", () => popup.style.display = "none");

spinBtn.addEventListener("click", () => {
  if (isSpinning) return;
  const available = prizes.filter(p => p.stock > 0);
  if (available.length === 0) {
    showPopup("ðŸŽ Stok hadiah sudah habis!");
    return;
  }

  isSpinning = true;
  let selectedPrize = pickPrize();
  if (!selectedPrize || selectedPrize.stock === 0) {
    selectedPrize = available[Math.floor(Math.random() * available.length)];
  }

  const prizeIndex = prizes.indexOf(selectedPrize);
  const sliceAngle = 360 / totalSlices;
  const randomSpin = 360 * 5; 
  const targetAngle = 90 - (prizeIndex * sliceAngle + sliceAngle / 2);
  const finalRotation = randomSpin + targetAngle;

  wheel.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
  wheel.style.transform = `rotate(${finalRotation}deg)`;

  wheel.addEventListener('transitionend', () => {
    currentRotation = finalRotation % 360;
    wheel.style.transition = 'none';
    wheel.style.transform = `rotate(${currentRotation}deg)`;
    selectedPrize.stock--;
    savePrizes();
    updateStockList();
    showPopup(selectedPrize.name);
    isSpinning = false;
  }, { once: true });
});

toggleStockBtn.addEventListener("click", () => {
  if (stockList.style.display === "none") {
    stockList.style.display = "block";
    toggleStockBtn.textContent = "ðŸ“‹ Sembunyikan Stok Hadiah";
  } else {
    stockList.style.display = "none";
    toggleStockBtn.textContent = "ðŸ“‹ Lihat Stok Hadiah";
  }
});

resetBtn.addEventListener("click", () => {
  if (confirm("Yakin ingin reset stok hadiah ke default?")) {
    prizes = JSON.parse(JSON.stringify(defaultPrizes));
    savePrizes();
    drawWheel();
    updateStockList();
  }
});

window.addEventListener('resize', resizeCanvas);

loadPrizes();
resizeCanvas();
updateStockList();
</script>
</body>
</html>





